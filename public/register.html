<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Register - API Key</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="card">
    <h2 style="text-align:center">Register (Create User + API Key)</h2>

    <label>First name</label>
    <input id="first_name" type="text" placeholder="First name" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;">

    <label>Last name</label>
    <input id="last_name" type="text" placeholder="Last name" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;">

    <label>API Key</label>
    <input id="apikey" type="text" placeholder="Generate API Key" readonly style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;background:#f4f6f8;">

    <button class="btn btn-primary" onclick="generateKey()">Generate API Key</button>
    <button class="btn btn-success" onclick="saveUser()">Simpan User + API Key</button>

    <div style="text-align:center;margin-top:12px">
      <a href="index.html">Kembali</a>
    </div>
  </div>

<script>
async function generateKey(){
  const res = await fetch('/generate-key', { method: 'POST' });
  const data = await res.json();
  if(data.success) document.getElementById('apikey').value = data.apikey;
  else alert('Gagal generate key');
}

async function saveUser(){
  const first_name = document.getElementById('first_name').value.trim();
  const last_name = document.getElementById('last_name').value.trim();
  const apikey = document.getElementById('apikey').value.trim();

  if(!first_name || !last_name || !apikey) {
    alert('Isikan first name, last name, dan generate API key terlebih dahulu.');
    return;
  }

  const res = await fetch('/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ first_name, last_name, apikey })
  });
  const out = await res.json();
  if(out.success){
    alert('Berhasil membuat user. Simpan API key: ' + out.apikey);
    window.location.href = 'index.html';
  } else {
    alert('Gagal: ' + (out.message || 'unknown'));
  }
}
</script>
</body>
</html>
