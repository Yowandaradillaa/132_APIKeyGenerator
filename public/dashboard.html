<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin</title>
  <style>
    body { font-family: Arial; background:#eef2f3; padding:20px; }

    /* Header dashboard */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    table { width:100%; border-collapse:collapse; background:white; }
    th, td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
    th { background:#333; color:white; }
    .status-active { color:green; font-weight:bold; }
    .status-inactive { color:red; font-weight:bold; }

    button { padding:6px 12px; border:none; cursor:pointer; }

    /* Delete button */
    .delete-btn { background:red; color:white; }
    .delete-btn:hover { background:darkred; }

    /* Logout button */
    .logout-btn { background:#444; color:white; }
    .logout-btn:hover { background:#111; }
  </style>
</head>

<body>

<div class="top-bar">
  <h2>Dashboard Admin ‚Äî List Users</h2>

  <!-- üî• Tombol Logout tetap ada -->
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Nama Depan</th>
      <th>Nama Belakang</th>
      <th>API Key</th>
      <th>Status</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="userTable"></tbody>
</table>

<script>
async function loadUsers() {
  const res = await fetch("/users");
  const data = await res.json();

  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";

  data.forEach(u => {
    const statusText = u.out_of_date === 1 ? "inactive" : "active";
    const statusClass = u.out_of_date === 1 ? "status-inactive" : "status-active";

    tbody.innerHTML += `
      <tr>
        <td>${u.id}</td>
        <td>${u.first_name}</td>
        <td>${u.last_name}</td>
        <td>${u.apikey_value ?? '-'}</td>
        <td class="${statusClass}">${statusText}</td>
        <td><button class="delete-btn" onclick="deleteUser(${u.id})">Delete</button></td>
      </tr>
    `;
  });
}

async function deleteUser(id) {
  if (!confirm("Yakin ingin menghapus user ini?")) return;

  const res = await fetch("/users/" + id, { method: "DELETE" });
  const out = await res.json();

  if (out.success) {
    alert("User deleted");
    loadUsers();
  } else {
    alert("Gagal menghapus user");
  }
}

/* Fitur Logout */
function logout() {
  localStorage.removeItem("adminToken");
  alert("Logout berhasil!");
  window.location.href = "index.html";   // ‚Üê balik ke file login kamu
}


loadUsers();
</script>

</body>
</html>
